var rideApp=rideApp||{};rideApp.form=function(a,b){var c=function(){d(),e(),f(),h(),this.assets.init(),this.checkLength.init(a("[maxlength]")),a("[data-toggle-dependant]").on("change",function(){j(a(this))}).each(function(){j(a(this))})},d=function(){a(document).on("click",".btn-file-delete",function(b){b.preventDefault();var c=a(this);confirm(c.data("message"))&&(c.parents(".form__item").find("input[type=hidden]").val(""),c.parent("div").remove())})},e=function(){a(document).on("click",".prototype-add:not(.disabled)",function(b){b.preventDefault();var c=a(this).parent(".collection-controls"),d=c.attr("data-prototype"),e=c.attr("data-index");e||(e=a(".collection-control",c).length),d=d.replace(/%prototype%/g,"prototype-"+e),a(".collection-control-group",c).first().append(d),e++,c.attr("data-index",e),c.trigger("collectionAdded")}),a(document).on("click",".prototype-remove:not(.disabled)",function(b){if(b.preventDefault(),confirm("Are you sure you want to remove this item?")){var c=a(this).closest(".collection-control");c.remove(),c.trigger("collectionRemoved")}})},f=function(){a("[data-order=true] .collection-control-group").sortable({axis:"y",cursor:"move",handle:".order-handle",items:"> .collection-control",select:!1,scroll:!0})},g={init:function(b){if(!b.length)return!1;var c=b.attr("maxlength");if(!c)return!1;var d=a('<div class="form__countdown" />').insertAfter(b);rideApp.form.checkLength.updateCount(b,d,c),b.on("keyup",function(){rideApp.form.checkLength.updateCount(b,d,c)})},updateCount:function(a,b,c){var d=a.val().length,e=parseInt(c,10),f=e-d>=0?e-d:0;return b.text(f),0>=f?!1:void 0}},h=function(){if(jQuery.fn.selectize){{a(".form--selectize")}a(".form--selectize select:visible").selectize(),a('a[data-toggle="tab"]').on("shown.bs.tab",function(){a(".form--selectize select:visible").selectize()})}},i={allAssets:a(".form__assets"),iframes:[],init:function(){var c=rideApp.form.assets.allAssets;c.each(function(){var c=a(this),d=c.data("field"),e=(a("#"+d),c.find(".form__edit-assets")),f=(e.text(),c.find(".form__add-assets"));rideApp.form.assets.checkAssetsLimit(),c.sortable({items:".form__asset"}).on("sortstop",function(){rideApp.form.assets.setAssetsOrder(c)}).disableSelection(),f.on("click",function(c){c.preventDefault();var d=a(this).attr("href"),e=a(d),f=e.find("iframe");f.attr("src")===b&&f.attr("src",f.data("src")),e.modal("show")}),$document.on("click",".form__remove-asset",function(a){a.preventDefault(),rideApp.form.assets.removeAsset(this)})})},setAssetsOrder:function(b){var c=b.sortable("toArray",{attribute:"data-id"}),d=b.data("field"),e=a("#"+d);e[0].value=c.join(",");var f=rideApp.form.assets.allAssets.filter('[data-field="'+d+'"] ').not(b);f.find(".form__asset").detach(),f.prepend(b.find(".form__asset").clone())},checkAssetsLimit:function(){var b=a(".form__assets");b.each(function(){var b=a(this),c=b.data("max"),d=b.find(".form__add-assets");b.find(".form__asset").length>=c?d.attr("disabled",!0):d.attr("disabled",!1)})},removeAsset:function(b){var c=a(b).parent(),d=c.parent(),e=c.data("id"),f=d.data("field"),g=(a("#"+f),a('[data-field="'+f+'"] [data-id="'+e+'"]'));g.addClass("is-removed").on("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",function(){g.remove(),rideApp.form.assets.setAssetsOrder(d),rideApp.form.assets.checkAssetsLimit()})},addAsset:function(b,c,d){var e=a(".modal.in"),f=e.find(".form__assets"),g=f.data("field"),h=(a("#"+g),a('[data-field="'+g+'"]')),i=h.find(".form__asset"),j=f.data("max");if(!(h.find('[data-id="'+b+'"]').length||i.length>=j)){var k=a('<div class="form__asset" data-id="'+b+'"><img src="'+d+'" alt="'+c+'"><a href="#" class="form__remove-asset">Ã—</a></div>');i.last().length?k.insertAfter(i.last()):k.prependTo(h),h.sortable("refresh"),rideApp.form.assets.checkAssetsLimit(),rideApp.form.assets.setAssetsOrder(f)}},resizeIframe:function(b,c){console.log(a("iframe",b.document)),a("iframe",b.document).height(c)}},j=function(b){var c=b.parents("form"),d=b.data("toggle-dependant"),e=c.find("[name^="+b.attr("name")+"]"),f=e.filter(":checked"),g=f.length?f.val():null;a("."+d,c).parents(".form__item").hide(),a("."+d+"-"+g,c).parents(".form__item").show()};return{initialize:c,checkLength:g,assets:i}}(jQuery),rideApp.form.initialize(),$.fn.formDependantRows=function(){var a=function(a){var b=a.parents("form"),c=a.data("toggle-dependant"),d=a.filter(":checked").length?a.val():null;$("."+c,b).parents(".form-group").hide(),$("."+c+"-"+d,b).parents(".form-group").show()};$("[data-toggle-dependant]",$(this)).on("change",function(){a($(this))}).each(function(){a($(this))})};