function updateQueryStringParameter(a,b,c){var d=new RegExp("([?&])"+b+"=.*?(&|$)","i"),e=-1!==a.indexOf("?")?"&":"?";return a.match(d)?a.replace(d,"$1"+b+"="+c+"$2"):a+e+b+"="+c}var rideApp=rideApp||{};rideApp.form=function(a,b){var c=a(document),d=function(){e(),f(),jQuery.fn.sortable&&g(),i(),j(),this.assets.init(),a("[maxlength]").each(function(){rideApp.form.checkLength.init(a(this),!1)}),a("[data-recommended-maxlength]").each(function(){rideApp.form.checkLength.init(a(this),!0)}),a("[data-toggle-dependant]").on("change",function(){l(a(this))}).each(function(){l(a(this))}),rideApp.translator.submitTranslationKeys()},e=function(){c.on("click",".btn-file-delete",function(b){b.preventDefault();var c=a(this);confirm(c.data("message"))&&(c.closest(".form__item").find("input[type=hidden]").val(""),c.parent("div").remove())})},f=function(){c.on("click",".prototype-add:not(.disabled)",function(b){b.preventDefault();var c=a(this).parent(".collection-controls"),d=c.attr("data-prototype"),e=c.attr("data-index");e||(e=a(".collection-control",c).length),d=d.replace(/%prototype%/g,"prototype-"+e),a(".collection-control-group",c).first().append(d),e++,c.attr("data-index",e),c.trigger("collectionAdded")}),c.on("click",".prototype-remove:not(.disabled)",function(b){if(b.preventDefault(),confirm("Are you sure you want to remove this item?")){var c=a(this).closest(".collection-control");c.trigger("collectionRemoved"),c.remove()}})},g=function(){a("[data-order=true] .collection-control-group").sortable({axis:"y",cursor:"move",handle:".order-handle",items:"> .collection-control",select:!1,scroll:!0})},h={init:function(b,c){if(!b.length)return!1;if(c)var d=b.attr("data-recommended-maxlength");else var d=b.attr("maxlength");if(!d)return!1;var e=a('<div class="form__countdown" />').insertAfter(b);rideApp.form.checkLength.updateCount(b,e,d,c),b.on("keyup",function(){rideApp.form.checkLength.updateCount(b,e,d,c)})},updateCount:function(a,b,c,d){var e=a.val().length,f=parseInt(c,10);if(d){var g=f-e;b.text(rideApp.translator.translate("label.length.recommended")+": "+g+"/"+c),0>g?b.addClass("text--warning"):b.removeClass("text--warning")}else{var g=f-e>=0?f-e:0;b.text(g+"/"+c)}return 0>=g&&!d?!1:void 0}},i=function(){if(jQuery.fn.selectize){var b=(a(".form--selectize"),{plugins:["drag_drop","remove_button"]});a(".form--selectize select:visible:not(.selectized)").selectize(b).addClass("selectized"),a('a[data-toggle="tab"]').on("shown.bs.tab",function(c){a(".form--selectize select:visible").selectize(b)}),c.on("collectionAdded",function(){a(".form--selectize select:visible:not(.selectized)").selectize(b).addClass("selectized")})}},j=function(){function b(b){var c=b.data("autocomplete-url"),d=b.data("autocomplete-multiple"),e=b.data("autocomplete-type"),f={valueField:"name",labelField:"name",searchField:"name",maxItems:d?null:1,create:b.hasClass("js-tags")?!0:!1,load:function(b,d){if(!b.length)return d();var f=c;f=f.replace(/%25term%25/g,b),f=f.replace(/%term%/g,b),a.get(f,function(b){"jsonapi"===e?res=b.meta.list:res=b;var c=a.map(res,function(a){return{name:a}});d(c)})}};b.selectize(f)}if(jQuery.fn.selectize){var c=a("[data-autocomplete-url]");c.each(function(){b(a(this))})}},k={allAssets:a(".form__assets"),iframes:[],init:function(){var d=rideApp.form.assets.allAssets;d.each(function(){var d=a(this),e=d.data("field"),f=(a("#"+e),d.find(".form__edit-assets"));f.text(),d.find(".form__add-assets");rideApp.form.assets.checkAssetsLimit(),d.sortable({items:".form__asset"}).on("sortstop",function(a,b){rideApp.form.assets.setAssetsOrder(d)}).disableSelection(),c.on("click",".form__add-assets",function(c){c.preventDefault();var d=a(this).attr("disabled");if("disabled"!==d){var e=a(this).attr("href"),f=a(e),g=f.find("iframe");g.attr("src")===b&&g.attr("src",g.data("src")),f.modal("show")}}),c.on("click",".form__remove-asset",function(a){a.preventDefault(),rideApp.form.assets.removeAsset(this)})})},setAssetsOrder:function(b){var c=b.sortable("toArray",{attribute:"data-id"}),d=b.data("field"),e=a("#"+d);e[0].value=c.join(",");var f=rideApp.form.assets.allAssets.filter('[data-field="'+d+'"] ').not(b);f.find(".form__asset").detach(),f.prepend(b.find(".form__asset").clone())},checkAssetsLimit:function(){var b=a(".form__assets");b.each(function(){var b=a(this),c=b.data("max"),d=b.find(".form__add-assets");b.find(".form__asset").length>=c?d.attr("disabled",!0):d.attr("disabled",!1)})},removeAsset:function(b){var c=a(b).parent(),d=c.parent(),e=c.data("id"),f=d.data("field"),g=(a("#"+f),a('[data-field="'+f+'"] [data-id="'+e+'"]'));g.addClass("is-removed").on("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",function(){g.remove(),rideApp.form.assets.setAssetsOrder(d),rideApp.form.assets.checkAssetsLimit()})},addAsset:function(b,c,d){var e=a(".modal.in"),f=e.find(".form__assets"),g=f.data("field"),h=(a("#"+g),a('[data-field="'+g+'"]')),i=h.find(".form__asset"),j=f.data("max");if(h.find('[data-id="'+b+'"]').length||i.length>=j)return void h.find('[data-id="'+b+'"]').find(".form__remove-asset").click();var k=a('<div class="form__asset" data-id="'+b+'"><img src="'+d+'" alt="'+c+'"><a href="#" class="form__remove-asset">Ã—</a></div>');i.last().length?k.insertAfter(i.last()):k.prependTo(h),h.sortable("refresh"),rideApp.form.assets.checkAssetsLimit(),rideApp.form.assets.setAssetsOrder(f)},resizeIframe:function(b,c){a("iframe",b.document).height(c)}},l=function(b){var c=b.parents("form"),d=b.data("toggle-dependant"),e=c.find('[name^="'+b.attr("name")+'"]'),f=e.filter(":checked"),g=f.length?f.val():null;a("."+d,c).parents(".form__item").hide(),a("."+d+"-"+g,c).parents(".form__item").show()};return{initialize:d,checkLength:h,assets:k}}(jQuery),$(document).ready(function(){rideApp.form.initialize()}),$.fn.formDependantRows=function(){var a=function(a){var b=a.parents("form"),c=a.data("toggle-dependant"),d=a.filter(":checked").length?a.val():null;$("."+c,b).parents(".form-group").hide(),$("."+c+"-"+d,b).parents(".form-group").show()};$("[data-toggle-dependant]",$(this)).on("change",function(){a($(this))}).each(function(){a($(this))})};