window.rideApp=window.rideApp||{},rideApp.content=function(a,b){function c(a){return String(a).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}var d=document.documentElement.lang,e=new JsonApiClient("/api/v1"),f=function(){var b,c,d,e=a(".js-rich-content");SirTrevor.Blocks.Heading=g.heading,SirTrevor.Blocks.Asset=g.asset,SirTrevor.Blocks.Tweet=g.tweet,SirTrevor.Blocks.Quote=g.quote,SirTrevor.Blocks.Wysiwyg=g.wysiwyg,e.each(function(){b=a(this),c=b.data("rich-content-properties"),d=b.data("redactor-properties"),c=a.extend(c,{el:b}),new SirTrevor.Editor(c)}),rideApp.translator.submitTranslationKeys()},g={wysiwyg:function(){return SirTrevor.Block.extend({type:"Wysiwyg",title:function(){return"Wysiwyg"},icon_name:"text",editorHTML:function(){var a=SirTrevor.getInstance(this.instanceID).$el.data("redactor-properties");return'<textarea class="st-text-block wysiwyg form__text" data-redactor-properties="'+c(JSON.stringify(a))+'"></textarea>'},loadData:function(b){var c=a(this.$editor);c.html(b.text)},save:function(){var a={};a.text=this.$editor.val(),_.isEmpty(a)||this.setData(a)},onBlockRender:function(b){this.$editor;a(document).trigger("collectionAdded")}})}(),heading:function(){var a=_.template('<<%- tagName %> class="st-required st-text-block st-text-block--heading" contenteditable="true"><%= text %></<%- tagName %>>'),b=function(b){return function(){this.$(".st-block-control-ui-btn--active").removeClass("st-block-control-ui-btn--active");var c=this.$(".st-text-block");c.replaceWith(a({tagName:b,text:c.html()})),this.$(".st-block-control-ui-btn--setHeading"+b[1]).addClass("st-block-control-ui-btn--active")}};return SirTrevor.Blocks.Heading.extend({editorHTML:function(){return a({tagName:"h2",text:""})},controllable:!0,controls:{setHeading2:b("h2"),setHeading3:b("h3"),setHeading4:b("h4")},loadData:function(a){b(a.tagName),this.$(".st-text-block").html(a.text)},toData:function(){var a={};a.text=SirTrevor.toHTML(this.getTextBlock().html(),this.type),a.tagName=this.getTextBlock().prop("tagName"),this.setData(a)}})}(),asset:function(){var b=0,c=window.location.origin,f=['<div class="grid">','<div class="grid__6">','<label for="<%- assetID %>" class="form__label">'+rideApp.translator.translate("label.file")+"</label>",'<div class="form__item form__assets st-assets-block" data-field="<%- assetID %>" data-max="1">','<a href="#<%- assetName %>" class="form__add-assets btn btn--brand"><i class="icon icon--plus"></i>'+rideApp.translator.translate("button.add")+"</a>","</div>",'<input type="hidden" name="<%- assetID %>" id="<%- assetID %>" data-name="<%- assetName %>" class="st-id-input" />',"</div>",'<div class="grid__4">','<label for="assetClass" class="form__label">'+rideApp.translator.translate("label.image.position")+"</label>",'<select name="className" id="assetClass" class="st-className-input form__select selectized">','<option value="left">'+rideApp.translator.translate("label.image.left")+"</option>",'<option value="center">'+rideApp.translator.translate("label.image.center")+"</option>",'<option value="right">'+rideApp.translator.translate("label.image.right")+"</option>",'<option value="stretch" selected>'+rideApp.translator.translate("label.image.stretch")+"</option>","</select>","</div>","</div>",'<div class="modal modal--large fade" id="<%- assetName %>" tabindex="-1" role="dialog" aria-labelledby="myModalAssetsAdd" aria-hidden="true">','<div class="modal-dialog">','<div class="modal-content">','<div class="modal-body">','<iframe data-url="'+c+"/admin/assets/"+d+'?embed=1&amp;selected=" frameborder="0" width="100%" height="500"></iframe>',"</div>",'<div class="modal-footer">','<div class="grid">','<div class="grid--bp-xsm__9">','<div class="form__assets form__assets--sml" data-field="<%- assetID %>" data-max="1"></div>',"</div>",'<div class="grid--bp-xsm__3 text--right">','<button type="button" class="btn btn--default" data-dismiss="modal">'+rideApp.translator.translate("button.done")+"</button>","</div>","</div>","</div>","</div>","</div>","</div>"].join("\n");return f=_.template(f),SirTrevor.Block.extend({type:"asset",icon_name:"image",editorHTML:function(){var a="rich-content-asset-"+b,c="modalAssetsAdd-assets-"+b;return b++,f({assetID:a,assetName:c})},getIdInput:function(){return this.$(".st-id-input")},getClassNameInput:function(){return this.$(".st-className-input")},getAssetBlock:function(){return this.$(".st-assets-block")},onBlockRender:function(){rideApp.form.assets.init(),this.getClassNameInput().selectize()},renderAndAddThumbnailWrapper:function(b,c){var d=a("<div>").attr({"class":"form__asset","data-id":c.id});d.append('<img src="'+c.assetThumbURL+'" width="100" height="100">'),d.append('<a href="#" class="form__remove-asset">Ã—</a>'),b.append(d)},loadData:function(a){if(a.id){var b=this;b.getIdInput().val(a.id);var c=b.getAssetBlock();if(a.assetThumbURL)b.renderAndAddThumbnailWrapper(c,a);else{var d=e.url+"/assets/"+a.id+"?fields[assets]=&url=true";e.sendRequest("GET",d,null,function(d){a.assetThumbURL=d._meta.url,b.renderAndAddThumbnailWrapper(c,a)})}a.className&&b.getClassNameInput().find("option[value="+a.className+"]").prop("selected","selected")}},save:function(){var a=this,b={},c=a.getAssetBlock().find("img");b.id=a.getIdInput().val(),b.assetThumbURL=c.attr("src"),b.className=a.getClassNameInput().val(),a.toData(b)},toData:function(a){this.setData(a)}})}(),tweet:function(){return SirTrevor.Block.extend({type:"tweet",icon_name:"twitter",title:function(){return i18n.t("blocks:tweet:title")},editorHTML:["<div>",'<div class="form__item">',"<div>",'<label for="st-tweet-embed" class="form__label">'+rideApp.translator.translate("label.embedCode")+"</label>","</div>",'<textarea name="st-tweet-embed" cols="90" rows="4"></textarea>',"</div>",'<div class="st-tweet-preview"></div>',"</div>"].join("\n"),getEmbedInput:function(){return this.$("textarea")},getPreviewElement:function(){return this.$(".st-tweet-preview")},loadData:function(a){this.getPreviewElement().html(a.embedCode),this.getEmbedInput().text(a.embedCode)},onBlockRender:function(){var a=this;this.getEmbedInput().on("keyup",function(b){a.setAndLoadData({embedCode:b.target.value})})}})}(),quote:function(){return SirTrevor.Block.extend({type:"quote",title:function(){return"Quote"},icon_name:"quote",editorHTML:['<div><label class="form__label">'+rideApp.translator.translate("label.quote")+"</label></div>",'<textarea name="text" class="st-required st-quote-text" cols="90" rows="4"></textarea>',"<hr/>",'<div><label class="form__label">'+rideApp.translator.translate("label.credit")+"</label></div>",'<input type="text" name="cite" class="st-cite-input"/>'].join("\n"),loadData:function(a){this.$(".st-quote-text").html(a.text),a.cite&&this.$(".st-cite-input").val(a.cite)}})}()};return{init:f}}(jQuery),$(document).ready(function(){rideApp.content.init()});